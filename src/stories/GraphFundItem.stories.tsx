import { ComponentStory, ComponentMeta } from '@storybook/react';
import { Client, makeOperation, OperationContext } from 'urql';
import { fromValue } from 'wonka';

import * as decorators from '../../.storybook/decorators';
import { GraphFundItem } from '~client/components/graph-fund-item';
import * as stubs from '~client/components/graph-fund-item/__tests__/stubs';
import { FundHistoryIndividual } from '~client/gql/queries/funds';
import { mockClient } from '~client/test-utils';

const fundHistoryIndividualData = {
  fundHistoryIndividual: {
    values: [
      { date: 1590484404, price: 987, __typename: 'FundValueIndividual' },
      { date: 1590512506, price: 982, __typename: 'FundValueIndividual' },
      { date: 1590598923, price: 981, __typename: 'FundValueIndividual' },
      { date: 1591117303, price: 998, __typename: 'FundValueIndividual' },
      { date: 1591203708, price: 1014, __typename: 'FundValueIndividual' },
      { date: 1591290119, price: 1010, __typename: 'FundValueIndividual' },
      { date: 1591376509, price: 1022, __typename: 'FundValueIndividual' },
      { date: 1591462930, price: 1022, __typename: 'FundValueIndividual' },
      { date: 1591635720, price: 1022, __typename: 'FundValueIndividual' },
      { date: 1591722115, price: 1008, __typename: 'FundValueIndividual' },
      { date: 1592931698, price: 1064, __typename: 'FundValueIndividual' },
      { date: 1593018109, price: 1042, __typename: 'FundValueIndividual' },
      { date: 1593104503, price: 1046, __typename: 'FundValueIndividual' },
      { date: 1593190898, price: 1050, __typename: 'FundValueIndividual' },
      { date: 1593277301, price: 1050, __typename: 'FundValueIndividual' },
      { date: 1593450103, price: 1056, __typename: 'FundValueIndividual' },
      { date: 1593536507, price: 1056, __typename: 'FundValueIndividual' },
      { date: 1593622894, price: 1060, __typename: 'FundValueIndividual' },
      { date: 1594400510, price: 1116, __typename: 'FundValueIndividual' },
      { date: 1594486912, price: 1116, __typename: 'FundValueIndividual' },
      { date: 1594659708, price: 1138, __typename: 'FundValueIndividual' },
      { date: 1594746081, price: 1106, __typename: 'FundValueIndividual' },
      { date: 1594832475, price: 1126, __typename: 'FundValueIndividual' },
      { date: 1594918892, price: 1114, __typename: 'FundValueIndividual' },
      { date: 1595005303, price: 1124, __typename: 'FundValueIndividual' },
      { date: 1595091699, price: 1124, __typename: 'FundValueIndividual' },
      { date: 1595264569, price: 1132, __typename: 'FundValueIndividual' },
      { date: 1595350917, price: 1146, __typename: 'FundValueIndividual' },
      { date: 1595437297, price: 1138, __typename: 'FundValueIndividual' },
      { date: 1596301303, price: 1094, __typename: 'FundValueIndividual' },
      { date: 1596474075, price: 1120, __typename: 'FundValueIndividual' },
      { date: 1596560491, price: 1120, __typename: 'FundValueIndividual' },
      { date: 1596646910, price: 1128, __typename: 'FundValueIndividual' },
      { date: 1596733305, price: 1126, __typename: 'FundValueIndividual' },
      { date: 1597942907, price: 1116, __typename: 'FundValueIndividual' },
      { date: 1598029298, price: 1128, __typename: 'FundValueIndividual' },
      { date: 1598115700, price: 1128, __typename: 'FundValueIndividual' },
      { date: 1599238891, price: 1084, __typename: 'FundValueIndividual' },
      { date: 1599325298, price: 1084, __typename: 'FundValueIndividual' },
      { date: 1599498098, price: 1106, __typename: 'FundValueIndividual' },
      { date: 1600362096, price: 1116, __typename: 'FundValueIndividual' },
      { date: 1600448499, price: 1110, __typename: 'FundValueIndividual' },
      { date: 1600534904, price: 1110, __typename: 'FundValueIndividual' },
      { date: 1600707705, price: 1076, __typename: 'FundValueIndividual' },
      { date: 1600794107, price: 1098, __typename: 'FundValueIndividual' },
      { date: 1602003697, price: 1146, __typename: 'FundValueIndividual' },
      { date: 1602090093, price: 1160, __typename: 'FundValueIndividual' },
      { date: 1602176493, price: 1180, __typename: 'FundValueIndividual' },
      { date: 1602262887, price: 1186, __typename: 'FundValueIndividual' },
      { date: 1603472485, price: 1192, __typename: 'FundValueIndividual' },
      { date: 1603558886, price: 1192, __typename: 'FundValueIndividual' },
      { date: 1603735299, price: 1180, __typename: 'FundValueIndividual' },
      { date: 1603821681, price: 1178, __typename: 'FundValueIndividual' },
      { date: 1603828261, price: 1178, __typename: 'FundValueIndividual' },
      { date: 1603828444, price: 1178, __typename: 'FundValueIndividual' },
      { date: 1603908068, price: 1154, __typename: 'FundValueIndividual' },
      { date: 1604944803, price: 1274, __typename: 'FundValueIndividual' },
      { date: 1605031212, price: 1234, __typename: 'FundValueIndividual' },
      { date: 1605117617, price: 1246, __typename: 'FundValueIndividual' },
      { date: 1605204009, price: 1250, __typename: 'FundValueIndividual' },
      { date: 1605290424, price: 1236, __typename: 'FundValueIndividual' },
      { date: 1605376811, price: 1236, __typename: 'FundValueIndividual' },
      { date: 1606413612, price: 1268, __typename: 'FundValueIndividual' },
      { date: 1606500012, price: 1288, __typename: 'FundValueIndividual' },
      { date: 1607709609, price: 1334, __typename: 'FundValueIndividual' },
      { date: 1607796009, price: 1334, __typename: 'FundValueIndividual' },
      { date: 1607968804, price: 1330, __typename: 'FundValueIndividual' },
      { date: 1608746404, price: 1346, __typename: 'FundValueIndividual' },
      { date: 1608832808, price: 1348, __typename: 'FundValueIndividual' },
      { date: 1608919210, price: 1348, __typename: 'FundValueIndividual' },
      { date: 1609005606, price: 1348, __typename: 'FundValueIndividual' },
      { date: 1609178408, price: 1348, __typename: 'FundValueIndividual' },
      { date: 1609264810, price: 1374, __typename: 'FundValueIndividual' },
      { date: 1609351206, price: 1358, __typename: 'FundValueIndividual' },
      { date: 1609437608, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1609524010, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1609610407, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1610560818, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1610647210, price: 1374, __typename: 'FundValueIndividual' },
      { date: 1610733618, price: 1364, __typename: 'FundValueIndividual' },
      { date: 1610820011, price: 1364, __typename: 'FundValueIndividual' },
      { date: 1610992825, price: 1370, __typename: 'FundValueIndividual' },
      { date: 1611079217, price: 1382, __typename: 'FundValueIndividual' },
      { date: 1611165616, price: 1406, __typename: 'FundValueIndividual' },
      { date: 1611252016, price: 1404, __typename: 'FundValueIndividual' },
      { date: 1612893615, price: 1434, __typename: 'FundValueIndividual' },
      { date: 1612980020, price: 1436, __typename: 'FundValueIndividual' },
      { date: 1613066413, price: 1458, __typename: 'FundValueIndividual' },
      { date: 1613227302, price: 1462, __typename: 'FundValueIndividual' },
      { date: 1613239205, price: 1462, __typename: 'FundValueIndividual' },
      { date: 1613412012, price: 1484, __typename: 'FundValueIndividual' },
      { date: 1614189606, price: 1402, __typename: 'FundValueIndividual' },
      { date: 1615226409, price: 1316, __typename: 'FundValueIndividual' },
      { date: 1615312814, price: 1344, __typename: 'FundValueIndividual' },
      { date: 1615399212, price: 1356, __typename: 'FundValueIndividual' },
      { date: 1615485604, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1615572005, price: 1362, __typename: 'FundValueIndividual' },
      { date: 1615658414, price: 1362, __typename: 'FundValueIndividual' },
      { date: 1615831209, price: 1376, __typename: 'FundValueIndividual' },
      { date: 1615917611, price: 1388, __typename: 'FundValueIndividual' },
      { date: 1617213611, price: 1352, __typename: 'FundValueIndividual' },
      { date: 1617300005, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1617386410, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1617472804, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1618423206, price: 1398, __typename: 'FundValueIndividual' },
      { date: 1618509611, price: 1410, __typename: 'FundValueIndividual' },
      { date: 1618596099, price: 1412, __typename: 'FundValueIndividual' },
      { date: 1618682413, price: 1412, __typename: 'FundValueIndividual' },
      { date: 1618855203, price: 1386, __typename: 'FundValueIndividual' },
      { date: 1618941614, price: 1364, __typename: 'FundValueIndividual' },
      { date: 1619028013, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1619892010, price: 1396, __typename: 'FundValueIndividual' },
      { date: 1620064807, price: 1396, __typename: 'FundValueIndividual' },
      { date: 1620194408, price: 1356, __typename: 'FundValueIndividual' },
      { date: 1620280809, price: 1370, __typename: 'FundValueIndividual' },
      { date: 1620367208, price: 1354, __typename: 'FundValueIndividual' },
      { date: 1621663206, price: 1304, __typename: 'FundValueIndividual' },
      { date: 1621922410, price: 1318, __typename: 'FundValueIndividual' },
      { date: 1622008809, price: 1318, __typename: 'FundValueIndividual' },
      { date: 1622095211, price: 1328, __typename: 'FundValueIndividual' },
      { date: 1622181609, price: 1332, __typename: 'FundValueIndividual' },
      { date: 1622268008, price: 1344, __typename: 'FundValueIndividual' },
      { date: 1623391211, price: 1334, __typename: 'FundValueIndividual' },
      { date: 1624514405, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1624600810, price: 1366, __typename: 'FundValueIndividual' },
      { date: 1624687210, price: 1366, __typename: 'FundValueIndividual' },
      { date: 1624946404, price: 1378, __typename: 'FundValueIndividual' },
      { date: 1625032814, price: 1394, __typename: 'FundValueIndividual' },
      { date: 1625119210, price: 1372, __typename: 'FundValueIndividual' },
      { date: 1625205613, price: 1378, __typename: 'FundValueIndividual' },
      { date: 1625292008, price: 1392, __typename: 'FundValueIndividual' },
      { date: 1626328808, price: 1406, __typename: 'FundValueIndividual' },
      { date: 1626415205, price: 1392, __typename: 'FundValueIndividual' },
      { date: 1626501608, price: 1386, __typename: 'FundValueIndividual' },
      { date: 1626760812, price: 1360, __typename: 'FundValueIndividual' },
      { date: 1626847207, price: 1386, __typename: 'FundValueIndividual' },
      { date: 1626933611, price: 1400, __typename: 'FundValueIndividual' },
      { date: 1628143211, price: 1416, __typename: 'FundValueIndividual' },
      { date: 1629180005, price: 1402, __typename: 'FundValueIndividual' },
      { date: 1632981610, price: 1406, __typename: 'FundValueIndividual' },
      { date: 1634364005, price: 1362, __typename: 'FundValueIndividual' },
      { date: 1635573609, price: 1382, __typename: 'FundValueIndividual' },
      { date: 1635785066, price: 1397.7, __typename: 'FundValueIndividual' },
    ],
    __typename: 'FundHistoryIndividual',
  },
};

const client: Client = {
  ...mockClient,
  executeQuery: (request) => {
    if (request.query === FundHistoryIndividual) {
      return fromValue({
        data: fundHistoryIndividualData,
        operation: makeOperation('query', request, {} as OperationContext),
      });
    }
    return fromValue({
      data: null,
      operation: makeOperation('query', request, {} as OperationContext),
    });
  },
} as Client;

const componentMeta: ComponentMeta<typeof GraphFundItem> = {
  title: 'GraphFundItem',
  component: GraphFundItem,
  decorators: [decorators.styles, decorators.gql(client)],
};

export default componentMeta;

const Template: ComponentStory<typeof GraphFundItem> = (args) => <GraphFundItem {...args} />;

export const Main = Template.bind({});
Main.args = {
  ...stubs.props,
};
