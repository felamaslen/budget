/* eslint-disable max-len */
import { render, RenderResult } from '@testing-library/react';
import endOfDay from 'date-fns/endOfDay';
import React from 'react';

import { GraphBalance, Props } from '.';
import { ResizeContext, TodayProvider } from '~client/hooks';
import { getOverviewGraphValues } from '~client/selectors';
import { testNow, testState as state } from '~client/test-data/state';
import { mockTime } from '~client/test-utils/mock-time';

describe('<GraphBalance />', () => {
  let randomSpy: jest.SpyInstance;

  const today = endOfDay(testNow);
  const mockedTime = mockTime(testNow);

  beforeEach(() => {
    mockedTime.setup();
    let randomIndex = 0;
    randomSpy = jest.spyOn(Math, 'random').mockImplementation((): number => {
      randomIndex += 1;
      return randomIndex % 2 === 0 ? 0.32 : 0.81;
    });
  });
  afterEach(() => {
    randomSpy.mockRestore();
    mockedTime.teardown();
  });

  const setup = (): RenderResult => {
    const graph = getOverviewGraphValues(today, 0)(state);
    const props: Props = {
      isMobile: false,
      showAll: false,
      setShowAll: jest.fn(),
      setMobileGraph: jest.fn(),
      isLoading: false,
      graph,
      longTermOptions: { enabled: false, rates: {} },
      setLongTermOptions: jest.fn(),
      defaultRates: { years: 30, income: 488500, stockPurchase: 255000, xirr: 0.18 },
    };

    return render(
      <TodayProvider>
        <ResizeContext.Provider value={894}>
          <GraphBalance {...props} />
        </ResizeContext.Provider>
      </TodayProvider>,
    );
  };

  it('should render a graph', async () => {
    expect.assertions(1);
    const { getByTestId } = setup();
    expect(getByTestId('graph-svg')).toMatchInlineSnapshot(`
      <svg
        data-testid="graph-svg"
        height="300"
        width="500"
      >
        <g>
          <g>
            <g>
              <line
                stroke="#999"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="300.5"
                y2="300.5"
              />
              <line
                stroke="#999"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="213.5"
                y2="213.5"
              />
              <line
                stroke="#999"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="126.5"
                y2="126.5"
              />
              <line
                stroke="#999"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="40.5"
                y2="40.5"
              />
            </g>
            <g>
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="282.5"
                y2="282.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="265.5"
                y2="265.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="248.5"
                y2="248.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="230.5"
                y2="230.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="196.5"
                y2="196.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="178.5"
                y2="178.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="161.5"
                y2="161.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="144.5"
                y2="144.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="109.5"
                y2="109.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="92.5"
                y2="92.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="74.5"
                y2="74.5"
              />
              <line
                stroke="#eaeaea"
                stroke-width="1"
                x1="0"
                x2="500"
                y1="57.5"
                y2="57.5"
              />
            </g>
            <g>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                text-anchor="start"
                x="0"
                y="298.5"
              >
                £0
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                text-anchor="start"
                x="0"
                y="211.5"
              >
                £20k
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                text-anchor="start"
                x="0"
                y="124.5"
              >
                £40k
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                text-anchor="start"
                x="0"
                y="38.5"
              >
                £60k
              </text>
            </g>
            <g>
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="-8.5"
                x2="-8.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="0.5"
                x2="0.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="11.5"
                x2="11.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="30.5"
                x2="30.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="49.5"
                x2="49.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="69.5"
                x2="69.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="77.5"
                x2="77.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="88.5"
                x2="88.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="107.5"
                x2="107.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="127.5"
                x2="127.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="146.5"
                x2="146.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="162.5"
                x2="162.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="165.5"
                x2="165.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="185.5"
                x2="185.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="204.5"
                x2="204.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="223.5"
                x2="223.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="243.5"
                x2="243.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="245.5"
                x2="245.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="262.5"
                x2="262.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="281.5"
                x2="281.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="301.5"
                x2="301.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="320.5"
                x2="320.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="331.5"
                x2="331.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="339.5"
                x2="339.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="359.5"
                x2="359.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="378.5"
                x2="378.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="397.5"
                x2="397.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="414.5"
                x2="414.5"
                y1="285"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="417.5"
                x2="417.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="436.5"
                x2="436.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="455.5"
                x2="455.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="475.5"
                x2="475.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#eaeaea"
                stroke-width="0.5"
                x1="494.5"
                x2="494.5"
                y1="295"
                y2="0"
              />
              <line
                stroke="#999"
                stroke-width="0.5"
                x1="500.5"
                x2="500.5"
                y1="285"
                y2="0"
              />
            </g>
            <g>
              <line
                stroke="#000"
                stroke-width="1"
                x1="-8.5"
                x2="-8.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="0.5"
                x2="0.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="11.5"
                x2="11.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="30.5"
                x2="30.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="49.5"
                x2="49.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="69.5"
                x2="69.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="77.5"
                x2="77.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="88.5"
                x2="88.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="107.5"
                x2="107.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="127.5"
                x2="127.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="146.5"
                x2="146.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="162.5"
                x2="162.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="165.5"
                x2="165.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="185.5"
                x2="185.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="204.5"
                x2="204.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="223.5"
                x2="223.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="243.5"
                x2="243.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="245.5"
                x2="245.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="262.5"
                x2="262.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="281.5"
                x2="281.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="301.5"
                x2="301.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="320.5"
                x2="320.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="331.5"
                x2="331.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="339.5"
                x2="339.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="359.5"
                x2="359.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="378.5"
                x2="378.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="397.5"
                x2="397.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="414.5"
                x2="414.5"
                y1="300"
                y2="285"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="417.5"
                x2="417.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="436.5"
                x2="436.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="455.5"
                x2="455.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="475.5"
                x2="475.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#000"
                stroke-width="1"
                x1="494.5"
                x2="494.5"
                y1="300"
                y2="295"
              />
              <line
                stroke="#333"
                stroke-width="1"
                x1="500.5"
                x2="500.5"
                y1="300"
                y2="285"
              />
            </g>
            <g>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 0.5 285)"
                x="0.5"
                y="285"
              >
                Feb
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 77.5 285)"
                x="77.5"
                y="285"
              >
                Mar
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 162.5 285)"
                x="162.5"
                y="285"
              >
                Apr
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 245.5 285)"
                x="245.5"
                y="285"
              >
                May
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 331.5 285)"
                x="331.5"
                y="285"
              >
                Jun
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 414.5 285)"
                x="414.5"
                y="285"
              >
                Jul
              </text>
              <text
                alignment-baseline="baseline"
                font-family="Arial, Helvetica, sans-serif"
                font-size="11"
                transform="rotate(-30 500.5 285)"
                x="500.5"
                y="285"
              >
                Aug
              </text>
            </g>
          </g>
          <g>
            <line
              stroke="#333"
              stroke-width="1"
              x1="113.5"
              x2="113.5"
              y1="300"
              y2="40"
            />
            <text
              color="#000"
              font-family="Arial, Helvetica, sans-serif"
              font-size="11"
              x="113.5"
              y="40"
            >
              Now
            </text>
          </g>
        </g>
        <g>
          <path
            d="M0,295.63291 Q45,211 77.3,198.4 C102,189 132,226 163.0,231.6 C191,237 217,231 245.9,231.1 C276,231 302,231 331.5,230.6 C360,230 385,230 414.4,230.1 Q444,230 500.0,229.7 L500.0,274.7 Q444,275 414.4,275.4 C385,276 360,276 331.5,276.1 C302,276 276,277 245.9,276.8 C217,277 191,281 163.0,277.5 C133,274 106,252 77.3,255.0 Q49,258 0.0,295.6"
            fill="rgba(180,214,169,0.3)"
            stroke="none"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0,222.81124333333332 Q41,128 77.3,100.1 C99,84 133,99 163.0,97.6 C192,96 217,94 245.9,91.5 C276,89 302,88 331.5,85.4 C361,83 385,81 414.4,79.2 Q444,77 500.0,73.0 L500.0,229.2 Q444,229 414.4,229.7 C385,230 360,230 331.5,230.1 C302,230 276,230 245.9,230.6 C217,231 191,236 163.0,231.1 C132,225 102,188 77.3,197.9 Q45,211 0.0,295.6"
            fill="rgba(150,140,39,0.5)"
            stroke="none"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0,295.63291 Q50,298 77.3,295.6 C107,293 133,285 163.0,282.7 C192,280 217,282 245.9,282.2 C276,282 302,282 331.5,281.7 C360,282 385,281 414.4,281.2 Q444,281 500.0,280.7 L500,300 L0,300"
            fill="rgba(84,110,122,0.4)"
            stroke="none"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0.0,285.3 L77.3,285.3 L163.0,285.3 L245.9,285.0 L331.5,284.8 L414.4,284.5 L500.0,284.2"
            fill="none"
            stroke="rgba(84,110,122,0.5)"
            stroke-dasharray="3,5"
            stroke-width="1"
          />
        </g>
        <g>
          <path
            d="M0,295.63291 Q49,258 77.3,255.0 C106,252 133,274 163.0,277.5 C191,281 217,277 245.9,276.8 C276,277 302,276 331.5,276.1 C360,276 385,276 414.4,275.4 Q444,275 500.0,274.7 L500.0,280.7 Q444,281 414.4,281.2 C385,281 360,282 331.5,281.7 C302,282 276,282 245.9,282.2 C217,282 192,280 163.0,282.7 C133,285 107,293 77.3,295.6 Q50,298 0.0,295.6"
            fill="rgba(145,194,129,0.4)"
            stroke="none"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0,227.17833333333334 Q42,129 77.3,104.9 C99,90 133,115 163.0,115.9"
            fill="none"
            stroke="#039"
            stroke-width="2"
          />
          <path
            d="M162.98342541436463,115.88325333333336 C192,117 217,112 245.9,109.8 C276,108 302,106 331.5,103.6 C361,101 385,100 414.4,97.4 Q444,95 500.0,91.2"
            fill="none"
            stroke="#808080"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0,295.63291 Q45,211 77.3,197.9 C102,188 132,225 163.0,231.1 C191,236 217,231 245.9,230.6 C276,230 302,230 331.5,230.1 C360,230 385,230 414.4,229.7 Q444,229 500.0,229.2 L500.0,229.7 Q444,230 414.4,230.1 C385,230 360,230 331.5,230.6 C302,231 276,231 245.9,231.1 C217,231 191,237 163.0,231.6 C132,226 102,189 77.3,198.4 Q45,211 0.0,295.6"
            fill="rgba(47,123,211,0.5)"
            stroke="none"
            stroke-width="2"
          />
        </g>
        <g>
          <path
            d="M0,227.17833333333334 Q41,128 77.3,103.4 C99,89 133,113 163.0,114.0 C192,115 217,110 245.9,107.8 C276,106 302,104 331.5,101.5 C361,99 385,97 414.4,95.3 Q444,93 500.0,88.9"
            fill="none"
            stroke="#5aa8be"
            stroke-dasharray="3,5"
            stroke-width="1"
          />
        </g>
        <g>
          <rect
            fill="rgba(255,255,255,0.6)"
            height="80"
            width="180"
            x="45"
            y="8"
          />
          <text
            alignment-baseline="hanging"
            color="#000"
            font-family="Arial, Helvetica, sans-serif"
            font-size="16"
            x="65"
            y="10"
          >
            Net worth
          </text>
          <line
            stroke="#039"
            stroke-width="2"
            x1="50"
            x2="74"
            y1="40"
            y2="40"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="78"
            y="40"
          >
            Actual
          </text>
          <line
            stroke="#808080"
            stroke-width="2"
            x1="130"
            x2="154"
            y1="40"
            y2="40"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="158"
            y="40"
          >
            Predicted
          </text>
          <rect
            fill="rgba(150,140,39,0.5)"
            height="6"
            width="24"
            x="130"
            y="85"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="158"
            y="88"
          >
            Illiquid equity
          </text>
          <rect
            fill="rgba(84,110,122,0.5)"
            height="6"
            width="24"
            x="50"
            y="53"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="78"
            y="56"
          >
            Stocks
          </text>
          <rect
            fill="#b4d6a9"
            height="6"
            width="24"
            x="50"
            y="69"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="78"
            y="72"
          >
            Cash
          </text>
          <rect
            fill="#91c281"
            height="6"
            width="24"
            x="130"
            y="69"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="158"
            y="72"
          >
            Locked cash
          </text>
          <rect
            fill="rgba(47,123,211,0.5)"
            height="6"
            width="24"
            x="50"
            y="85"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="78"
            y="88"
          >
            Pension
          </text>
          <line
            stroke="#5aa8be"
            stroke-dasharray="3,4"
            stroke-width="2"
            x1="130"
            x2="154"
            y1="56.5"
            y2="56.5"
          />
          <text
            alignment-baseline="middle"
            fill="#333"
            font-family="Arial, Helvetica, sans-serif"
            font-size="11"
            x="158"
            y="56"
          >
            Options
          </text>
        </g>
      </svg>
    `);
  });
});
